<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Introduction</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="three-panel-container" id="three-panels">
        <div class="panel panel-left" id="panel-1"></div>
        <div class="panel panel-center" id="panel-2"></div>
        <div class="panel panel-right" id="panel-3"></div>
    </div>
    
    <div class="white-screen" id="white-screen">
        <div class="star-bg"></div>
        <div class="white-screen-text" id="white-screen-text"></div>
    </div>
    
    
    <div class="container">
        <button id="start-button" class="neon-button">
            <span class="button-text">Begin</span>
            <div class="button-glow"></div>
        </button>
    </div>
    
    <script>
        // Game Introduction Script
        document.addEventListener('DOMContentLoaded', function() {
            const startButton = document.getElementById('start-button');
            let audio = null;
            let isPlaying = false;
            
            // Initialize audio with multiple format support
            function initAudio() {
                // Try different audio formats in order of preference
                const audioFormats = [
                    'assets/opening.wav',
                    'assets/opening.mp3', 
                    'assets/opening.aif'
                ];
                
                audio = new Audio();
                audio.volume = 0.7;
                audio.loop = true;
                audio.preload = 'auto';
                
                // Set the first available format
                audio.src = audioFormats[0];
                
                // Add event listeners
                audio.addEventListener('loadstart', () => console.log('Audio load started'));
                audio.addEventListener('loadeddata', () => console.log('Audio data loaded'));
                audio.addEventListener('loadedmetadata', () => console.log('Audio metadata loaded'));
                audio.addEventListener('canplay', () => console.log('Audio can play'));
                audio.addEventListener('canplaythrough', () => console.log('Audio ready to play'));
                audio.addEventListener('play', () => {
                    console.log('Audio started playing');
                    isPlaying = true;
                });
                audio.addEventListener('pause', () => {
                    console.log('Audio paused');
                    isPlaying = false;
                });
                audio.addEventListener('error', (e) => {
                    console.error('Audio error:', e);
                    console.error('Error code:', e.target.error.code);
                    console.error('Error message:', e.target.error.message);
                    
                    // Try next format if current one fails
                    const currentIndex = audioFormats.indexOf(audio.src);
                    if (currentIndex < audioFormats.length - 1) {
                        console.log('Trying next audio format...');
                        audio.src = audioFormats[currentIndex + 1];
                    }
                });
            }
            
            // Handle button click
            startButton.addEventListener('click', async function() {
                console.log('BEGIN button clicked!');
                
                try {
                    if (!audio) {
                        initAudio();
                    }
                    
                    if (isPlaying) {
                        audio.pause();
                        audio.currentTime = 0;
                        isPlaying = false;
                        console.log('Music paused');
                    } else {
                        await audio.play();
                        console.log('Music started successfully');
                        
                        // Start the transition to white screen
                        setTimeout(() => {
                            transitionToWhiteScreen();
                        }, 500); // Wait 0.5 seconds after music starts
                    }
                } catch (error) {
                    console.error('Could not play music:', error);
                    console.log('Trying alternative approach...');
                    
                    // Try to load and play again
                    try {
                        audio.load();
                        await audio.play();
                        console.log('Music started on retry');
                        
                        // Start the transition to white screen
                        setTimeout(() => {
                            transitionToWhiteScreen();
                        }, 500);
                    } catch (retryError) {
                        console.error('Retry failed:', retryError);
                        alert('Could not play audio. Please check if the audio file exists and your browser supports audio playback.');
                    }
                }
                
                // Add visual feedback
                startButton.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    startButton.style.transform = 'scale(1)';
                }, 150);
            });
            
            // Function to transition to white screen with smooth fade between messages
function transitionToWhiteScreen() {
  const container = document.querySelector('.container');
  const whiteScreen = document.getElementById('white-screen');
  const whiteScreenText = document.getElementById('white-screen-text');

  // helper: wait function
  const wait = (ms) => new Promise((res) => setTimeout(res, ms));

  // Fade out Begin button
  container.style.transition = 'opacity 0.8s ease-in-out';
  container.style.opacity = '0';

  // Fade in black screen
  setTimeout(async () => {
    whiteScreen.classList.add('visible');

  // --- first message ---
await wait(2100);
whiteScreenText.textContent = "I was a dreamer once";
whiteScreenText.classList.add('visible');

// Hold for a bit
await wait(2200);

// --- fade out first message ---
whiteScreenText.classList.remove('visible');
await wait(1400); // matches CSS fade speed

// --- second message ---
whiteScreenText.textContent = "I dreamt of peace";
whiteScreenText.classList.add('visible');

// Hold for second message
await wait(2200);

// --- fade out second message ---
whiteScreenText.classList.remove('visible');
await wait(1400); // matches CSS transition

// --- third message ---
whiteScreenText.textContent = "I dreamt of love";
whiteScreenText.classList.add('visible');

// Hold for third message
await wait(2200);

// --- fade out third message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- fourth message ---
whiteScreenText.textContent = "I dreamt of happiness";
whiteScreenText.classList.add('visible');

// Hold for fourth message
await wait(2200);

// --- fade out fourth message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- fifth message ---
whiteScreenText.textContent = "But they";
whiteScreenText.classList.add('visible');

// Hold for fifth message
await wait(2200);

// --- fade out fifth message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- sixth message ---
whiteScreenText.textContent = "They took that dream from me";
whiteScreenText.classList.add('visible');

// Hold for sixth message
await wait(2200);

// --- fade out sixth message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- seventh message ---
whiteScreenText.textContent = "They stripped me of my purpose";
whiteScreenText.classList.add('visible');

// Hold for seventh message
await wait(2200);

// --- fade out seventh message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- eighth message ---
whiteScreenText.textContent = "And a man without a purpose";
whiteScreenText.classList.add('visible');

// Hold for eighth message
await wait(2200);

// --- fade out eighth message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- ninth message ---
whiteScreenText.textContent = "Reverts to his old ways";
whiteScreenText.classList.add('visible');
// Hold for ninth message
await wait(2200);

// --- fade out ninth message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- tenth message ---
whiteScreenText.textContent = "Unfortunately for them";
whiteScreenText.classList.add('visible');
// Hold for tenth message
await wait(2200);

// --- fade out tenth message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- eleventh message ---
whiteScreenText.textContent = "My old ways consist of";
whiteScreenText.classList.add('visible');
// Hold for eleventh message
await wait(2200);

// --- fade out eleventh message ---
whiteScreenText.classList.remove('visible');
await wait(1400);

// --- twelfth message ---
whiteScreenText.textContent = "Brutality";
whiteScreenText.classList.add('visible');
// Hold for twelfth message
await wait(2200);

}, 800);
}
            
            // Add keyboard support
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    startButton.click();
                }
            });
            
            // Initialize audio on page load
            initAudio();
        });
    </script>
</body>
</html>
